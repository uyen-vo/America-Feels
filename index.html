<!DOCTYPE html>
	<head>
	<meta charset="utf-8">
	<title>America Feels</title>
	<link rel="stylesheet" href="css/style.css">
    </head>
    <body>
        <section>
            <h1><i class = "fa fa-twitter"></i> America Feels </h1>
            <p> This map shows the how each state feels.</p>
            <!--These scripts generate the US map as well as coloring functions-->
            <script src="https://d3js.org/d3.v3.min.js"></script>
            <script src="https://d3js.org/topojson.v2.min.js"></script>
            <script src="js/function.js"></script>
            <script>
            //Width and height
            var width = 960;
            var height = 600;

            //Map Projection
            var projection = d3.geo.albersUsa()
                .translate([width/2, height/2])
                .scale([1000]);

            //Path Generator
            var path = d3.geo.path()
                .projection(projection);

            var length = 100;
            var color = d3.scale.linear().domain([1,length])
                .interpolate(d3.interpolateHcl)
                .range([d3.rgb("#FC0300"), d3.rgb('#FFF900')]);

            var svg = d3.select("body")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

                d3.json("json/us-states.json", function(json) {
                    svg.selectAll("path")
                    .data(json.features)
                    .enter()
                    .append("path")
                    .attr("d", path)
                    .style("fill", function(d) {
                        // Get data value
                        var value = d.properties.value;

                        if (value) {
                            //If value exists…
                            return "#0666a5";
                        } else {
                            //If value is undefined…
                            return "#ccc";
                        }
                    });
                });
            function changeColor(state, value) {
                var condition;
                condition = color(value);
                console.log(condition);
                svg.selectAll("path")
                    .style("fill", function(d){
                        //console.log(d.proprties.name.toString());
                        // var stateName = d.properties["name"];
                        var stateName = d.properties["STATE_ABBR"];
                        console.log(state);
                        if(stateName === state) {
                            return condition;
                        }
                        else {
                            return "#06666a5";
                        }
                    });
                }
            function getRandomArbitrary(min, max) {
                return Math.floor(Math.random() * (max - min)) + min;
            }
            var requestHolder;
            function analyzeTextData(state, tweet) {
                var data = generateJSON(tweet);
                //console.log(data);
                var request = new XMLHttpRequest();
                request.open('POST', 'https://westus.api.cognitive.microsoft.com/text/analytics/v2.0/sentiment');
                request.setRequestHeader('Ocp-Apim-Subscription-Key', 'fd98ecfa17ca4b439fcf66166864b049');
                request.setRequestHeader('Content-Type', 'application/json');
                request.setRequestHeader('Accept', 'application/json');
                request.send(data);
                request.onreadystatechange = function () {
                    if (request.readyState == XMLHttpRequest.DONE) {
                        var r1 = request.responseText;
                var results = JSON.parse(r1);
                        console.log(results);
                        var score = results["documents"][0]["score"];
                        var scoreValue = score*100;
                        console.log(scoreValue);
                        changeColor(state, scoreValue);
                    }
                }
            }
            function generateJSON(tweet) {
                var jsonObject =
                    {
                        "documents": [
                            {
                                "language": "en",
                                "id": "1",
                                "text": tweet
                            }
                        ]
                    };
                var json = JSON.stringify(jsonObject);
                return json;
            }
            </script>
        </section>
        <section class="legendbox">
            <ul>
                <li><div class="happy"></div>Positive tweets</li>
                <li><div class="neutral"></div>Equal number of positive and negative tweets</li>
                <li><div class="sad"></div>Negative tweets</li>
            </ul>
            <ul>
                <img src="images/colorSpectrum.png" alt="Color Key" style="width:450px;height:50px;">
            </ul>
        </section>
        <section>
            <!--<input type="button" onclick="analyzeTextData('Texas', '')" value="analyzeTextData('Texas', '')">-->
            <input type="button" onclick="analyzeTextData('FL', 'I aboslutely love the weather around this time of the year!!!')" value="analyzeTextData('FL', 'I aboslutely love the weather around this time of the year!!!')">
            <input type="button" onclick="analyzeTextData('NM', 'You have got to be shiiting me. I have to pay 40% of my money as tax??')" value="analyzeTextData('NM', 'You have got to be shiiting me. I have to pay 40% of my money as tax??')">
            <input type="button" onclick="analyzeTextData('GA', 'Meh, another win for the patriots....')" value="analyzeTextData('GA', 'Meh, another win for the patriots....')">
            <input type="button" onclick="analyzeTextData('CA', 'Legalize Weed Man! God gave us plants lets smoke them.')" value="analyzeTextData('CA', 'Legalize Weed Man! God gave us plants lets smoke them.')">
            <input type="button" onclick="analyzeTextData('TX', 'Hell yeah! The rockets are aboslutely amazing. Best point guard I have ever seen!')" value="analyzeTextData('Texas', 'Hell yeah! The rockets are aboslutely amazing. Best point guard I have ever seen!')">
        </section>
    </body>
</html>


